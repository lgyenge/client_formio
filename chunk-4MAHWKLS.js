import{a as Me}from"./chunk-QBTD7MMS.js";import{b as Fe}from"./chunk-EBPMJSX6.js";import{a as we,b,g as Ie}from"./chunk-P4YLKB57.js";import"./chunk-RYFXDC4W.js";import{a as X}from"./chunk-UIZ74LUX.js";import{a as Y,b as Z,c as ee,e as te,f as ie,g as oe,j as re,k as be,l as xe,o as ne,p as ye}from"./chunk-UNB647CC.js";import{A as J,Ba as p,D as ue,Da as k,Db as C,E as $,Eb as R,J as u,K as B,Kb as N,Mb as _e,Nb as Ce,O as w,P as I,Pb as W,T as Q,Y as d,Ya as P,Z as n,Za as j,bb as Se,fa as F,ha as f,j as me,jb as h,ka as s,kb as D,l as le,la as a,lb as _,m as de,ma as g,mb as z,nb as K,ob as ce,qa as E,ra as S,sa as v,u as q,va as H,w as G,xa as he,y as U,ya as ve,z as fe,za as ge}from"./chunk-ICJVGW3A.js";function Ge(r,t){if(r&1){let c=E();s(0,"tr",11),S("click",function(){let e=w(c),o=e.$implicit,m=e.index,l=v();return I(l.ClickedRow(m,o))}),s(1,"td"),p(2),a(),s(3,"td"),p(4),a(),s(5,"td"),p(6),a()()}if(r&2){let c=t.$implicit;d(2),k(" ",c.title," "),d(2),k(" ",c.name," "),d(2),k(" ",c.modified," ")}}var Ee=(()=>{let t=class t{constructor(i,e,o,m){this.appConfig=i,this.fb=e,this.route=o,this.router=m,this.userSearchResults=[],this.userDisplayResults=[],this.form_ids=[],this.loadFormsSubscription=new me,this.searchFormSubscription=new me,this.service=new R(this.appConfig.appUrl)}ClickedRow(i,e){localStorage.setItem("form_id",this.userDisplayResults[i]._id??""),this.FindStep(1,e)}FindStep(i,e){let m={params:{name__regex:"/"+e.name+"/i",tags__eq:["common"],type:"form"}};this.loadFormsSubscription=this.service.loadForms(m).subscribe(l=>{let M=l;M.sort((x,O)=>{let T=(x.name??"").toUpperCase(),pe=(O.name??"").toUpperCase();return T<pe?-1:T>pe?1:0}),M.forEach(x=>{x._id&&this.form_ids.push(x._id)}),localStorage.setItem("forms",JSON.stringify(M)),this.router.navigate(["lot"],{relativeTo:this.route})})}ngOnDestroy(){this.loadFormsSubscription.unsubscribe(),this.searchFormSubscription.unsubscribe()}ngOnInit(){this.searchForm=this.fb.group({name:[""]}),localStorage.setItem("forms",""),this.searchFormSubscription=this.searchForm.get("name").valueChanges.pipe(G(400),q(i=>i.length>2),J({next:i=>{localStorage.setItem("meo_query",JSON.stringify({params:{title__regex:"/"+i+"/i",tags__eq:["common"],type:"form"}})),localStorage.setItem("meo_searchInput",i)}}),U(i=>this.service.loadForms(JSON.parse(localStorage.getItem("meo_query")||"{}")))).subscribe(i=>{this.userSearchResults=i,this.userDisplayResults=i.filter(e);function e(o){return o.name,o.name&&!(o.name.substring(o.name.length-2,o.name.length)==="x1"||o.name.substring(o.name.length-2,o.name.length)==="x2"||o.name.substring(o.name.length-2,o.name.length)==="x3")}})}};t.\u0275fac=function(e){return new(e||t)(n(C),n(re),n(h),n(_))},t.\u0275cmp=u({type:t,selectors:[["app-meo"]],decls:18,vars:2,consts:[[3,"formGroup"],[1,"mb-3"],["formControlName","name","placeholder","Search Implant",1,"form-control"],[1,"row","mt-3"],[1,"col"],[1,"table-responsive"],[1,"table","table-hover"],[1,"thead-light"],["width","150"],["width","150",1,"text-center"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(e,o){e&1&&(g(0,"router-outlet"),s(1,"form",0)(2,"div",1),g(3,"input",2),a()(),s(4,"div",3)(5,"div",4)(6,"div",5)(7,"table",6)(8,"thead",7)(9,"tr")(10,"th"),p(11,"Title"),a(),s(12,"th",8),p(13,"Name"),a(),s(14,"th",9),p(15,"Modified"),a()()(),s(16,"tbody"),F(17,Ge,7,3,"tr",10),a()()()()()),e&2&&(d(),f("formGroup",o.searchForm),d(16),f("ngForOf",o.userDisplayResults))},dependencies:[P,D,te,Y,Z,ee,ie,oe]});let r=t;return r})();function Ue(r,t){if(r&1){let c=E();s(0,"tr",11),S("click",function(){let e=w(c),o=e.$implicit,m=e.index,l=v();return I(l.ClickedRow(m,o))}),s(1,"td"),p(2),a(),s(3,"td"),p(4),a(),s(5,"td"),p(6),a()()}if(r&2){let c=t.$implicit;d(2),k(" ",c.data.lot," "),d(2),k(" ",c.data.description," "),d(2),k(" ",c.data.inproduction," ")}}var ke=(()=>{let t=class t{constructor(i,e,o,m){this.appConfig=i,this.fb=e,this.route=o,this.router=m,this.userSearchResults=[],this.form_id="",this.url=this.appConfig.appUrl+"/form/"+Fe.lotId+"/submission",this.destroy$=new le,this.service=new R(this.url)}ClickedRow(i,e){localStorage.setItem("lot_no",this.userSearchResults[i].data.lot),this.form_id=localStorage.getItem("form_id"),this.router.navigate(["step",this.form_id],{relativeTo:this.route})}ngOnInit(){this.searchForm=this.fb.group({lot:[""]}),this.searchForm.get("lot")?.valueChanges.pipe(G(400),q(i=>i.length>1),J({next:i=>{localStorage.setItem("meo_lot_query",JSON.stringify({params:{"data.lot__regex":"/"+i+"/i","data.inproduction":"true",type:"resource"}})),localStorage.setItem("meo_lot_searchInput",i)}}),U(i=>this.service.loadSubmissions(JSON.parse(localStorage.getItem("meo_lot_query")||"{}"))),fe(this.destroy$)).subscribe(i=>{this.userSearchResults=i})}};t.\u0275fac=function(e){return new(e||t)(n(C),n(re),n(h),n(_))},t.\u0275cmp=u({type:t,selectors:[["app-meo-lot"]],decls:17,vars:2,consts:[[3,"formGroup"],[1,"mb-3"],["formControlName","lot","placeholder","Search Lot No",1,"form-control"],[1,"row","mt-3"],[1,"col"],[1,"table-responsive"],[1,"table","table-hover"],[1,"thead-light"],["width","550"],["width","100",1,"text-center"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(e,o){e&1&&(s(0,"form",0)(1,"div",1),g(2,"input",2),a()(),s(3,"div",3)(4,"div",4)(5,"div",5)(6,"table",6)(7,"thead",7)(8,"tr")(9,"th"),p(10,"Lot number"),a(),s(11,"th",8),p(12,"Description"),a(),s(13,"th",9),p(14,"Production"),a()()(),s(15,"tbody"),F(16,Ue,7,3,"tr",10),a()()()()()),e&2&&(f("formGroup",o.searchForm),d(16),f("ngForOf",o.userSearchResults))},dependencies:[P,te,Y,Z,ee,ie,oe]});let r=t;return r})();var ae=(()=>{let t=class t{constructor(){this.message=new de("Initial message!!!"),this.getMessage=this.message.asObservable()}sendMessage(i){this.message.next(i)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ue({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();function $e(r,t){if(r&1&&(s(0,"li",4)(1,"a",5),p(2," #1"),a()()),r&2){let c=v();d(),H("routerLink",c.header1)}}function Be(r,t){if(r&1&&(s(0,"li",4)(1,"a",5),p(2," #2"),a()()),r&2){let c=v();d(),H("routerLink",c.header2)}}function Qe(r,t){r&1&&(s(0,"li",4)(1,"a",8),p(2,"Excel"),a()())}var Le=(()=>{let t=class t{updateForm(i){this.dataService.sendMessage(i)}constructor(i,e,o,m,l,M){this.service=i,this.auth=e,this.route=o,this.appConfig=m,this.router=l,this.dataService=M,this.forms=JSON.parse(localStorage.getItem("forms")??"[]"),this.header="/meo/lot/step/"+this.forms[0]._id+"/header",this.header1="/meo/lot/step/"+this.forms[1]?._id+"/header",this.header2="/meo/lot/step/"+this.forms[2]?._id+"/header"}ngOnInit(){this.route.params.subscribe(i=>{this.updateForm(i.id)}),this.service.reset(this.route)}};t.\u0275fac=function(e){return new(e||t)(n(b),n(W),n(h),n(C),n(_),n(ae))},t.\u0275cmp=u({type:t,selectors:[["app-meo-step"]],decls:14,vars:4,consts:[["aria-label","Submission","role","navigation",1,"nav","nav-tabs",2,"margin-bottom","10px"],[1,"nav-item"],["routerLink","../../",1,"nav-link"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"],["routerLinkActive","active",1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"],["class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","new","routerLinkActive","active",1,"nav-link"],["routerLink","save","routerLinkActive","active",1,"nav-link"]],template:function(e,o){e&1&&(s(0,"ul",0)(1,"li",1)(2,"a",2),g(3,"em",3),a()(),s(4,"li",4)(5,"a",5),p(6," #0"),a()(),F(7,$e,3,1,"li",6)(8,Be,3,1,"li",6)(9,Qe,3,0,"li",6),s(10,"li",4)(11,"a",7),p(12,"New"),a()()(),g(13,"router-outlet")),e&2&&(d(5),H("routerLink",o.header),d(2),f("ngIf",o.forms[1]==null?null:o.forms[1]._id),d(),f("ngIf",o.forms[2]==null?null:o.forms[2]._id),d(),f("ngIf",o.auth.is.administrator))},dependencies:[j,D,z,K]});let r=t;return r})();function He(r,t){if(r&1){let c=E();s(0,"formio-grid",1),S("rowAction",function(e){w(c);let o=v();return I(o.onAction(e))})("rowSelect",function(e){w(c);let o=v();return I(o.onSelect(e))}),a()}if(r&2){let c=v();f("formio",c.serviceFormioConverted)("query",c.query)("isActionAllowed",c.service.actionAllowed)}}var Te=(()=>{let t=class t{constructor(i,e,o,m,l){this.route=i,this.router=e,this.service=o,this.dataService=m,this.appConfig=l,this.query={"data.lot1__eq":localStorage.getItem("lot_no")},this.msg="674df6f4b9e053f61d9102e9",this.serviceFormioConverted=this.service.formio}ngOnDestroy(){this.subscription?.unsubscribe()}ngOnInit(){this.subscription=this.dataService.getMessage.subscribe(i=>{this.msg=i,this.service.ready.then(()=>{this.formGrid.formio=new Ce.Formio(this.appConfig.appUrl+"/form/"+i),this.formGrid.refreshGrid(this.query)})})}onSelect(i){this.router.navigate([i._id,"view"],{relativeTo:this.route})}onAction(i){this.service.form=null,this.router.navigate([i.row._id,i.action],{relativeTo:this.route})}onCreateItem(){this.router.navigate(["create"],{relativeTo:this.route})}isActionAllowed(i){return!0}};t.\u0275fac=function(e){return new(e||t)(n(h),n(_),n(b),n(ae),n(C))},t.\u0275cmp=u({type:t,selectors:[["app-meo-step-index"]],viewQuery:function(e,o){if(e&1&&he(ne,5),e&2){let m;ve(m=ge())&&(o.formGrid=m.first)}},decls:1,vars:1,consts:[[3,"formio","query","isActionAllowed","rowAction","rowSelect",4,"ngIf"],[3,"rowAction","rowSelect","formio","query","isActionAllowed"]],template:function(e,o){e&1&&F(0,He,1,3,"formio-grid",0),e&2&&f("ngIf",o.service.ready)},dependencies:[j,ne]});let r=t;return r})();function Pe(r,t){if(r&1){let c=E();s(0,"formio",1),S("formLoad",function(e){w(c);let o=v();return I(o.service.setForm(e))})("submissionLoad",function(e){w(c);let o=v();return I(o.service.submissionLoaded(e))}),a()}if(r&2){let c=v();f("renderer",c.service.config.renderer)("src",c.service.formio.submissionUrl)("readOnly",!0)}}var je=(()=>{let t=class t{constructor(i,e,o){this.service=i,this.route=e,this.appConfig=o}};t.\u0275fac=function(e){return new(e||t)(n(b),n(h),n(C))},t.\u0275cmp=u({type:t,selectors:[["app-meo-step-view"]],decls:1,vars:1,consts:[[3,"renderer","src","readOnly","formLoad","submissionLoad",4,"ngIf"],[3,"formLoad","submissionLoad","renderer","src","readOnly"]],template:function(e,o){e&1&&F(0,Pe,1,3,"formio",0),e&2&&f("ngIf",!0)},dependencies:[j,N]});let r=t;return r})();var De=(()=>{let t=class t{constructor(i,e){this.service=i,this.route=e}ngOnInit(){this.service.setSubmission(this.route).then(i=>{console.log(this.service)})}};t.\u0275fac=function(e){return new(e||t)(n(b),n(h))},t.\u0275cmp=u({type:t,selectors:[["app-meo-step-header"]],decls:16,vars:0,consts:[["aria-label","Submission","role","navigation",1,"nav","nav-tabs",2,"margin-bottom","10px"],[1,"nav-item"],["routerLink","../",1,"nav-link"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"],["routerLinkActive","active",1,"nav-item"],["routerLink","view","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-eye","bi","bi-eye"],["routerLink","edit","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-edit","bi","bi-pencil-square"],["routerLink","delete","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-trash","bi","bi-trash"]],template:function(e,o){e&1&&(s(0,"ul",0)(1,"li",1)(2,"a",2),g(3,"em",3),a()(),s(4,"li",4)(5,"a",5),g(6,"em",6),p(7," View"),a()(),s(8,"li",4)(9,"a",7),g(10,"em",8),p(11," Edit"),a()(),s(12,"li",4)(13,"a",9),g(14,"span",10),a()()(),g(15,"router-outlet"))},dependencies:[D,z,K]});let r=t;return r})();var Re=(()=>{let t=class t{constructor(i,e,o){this.service=i,this.router=e,this.route=o}onSubmit(i){this.router.navigate(["../../"],{relativeTo:this.route})}};t.\u0275fac=function(e){return new(e||t)(n(b),n(_),n(h))},t.\u0275cmp=u({type:t,selectors:[["app-meo-step-edit"]],decls:1,vars:2,consts:[[3,"submit","formLoad","submissionLoad","renderer","src"]],template:function(e,o){e&1&&(s(0,"formio",0),S("submit",function(l){return o.onSubmit(l)})("formLoad",function(l){return o.service.setForm(l)})("submissionLoad",function(l){return o.service.submissionLoaded(l)}),a()),e&2&&f("renderer",o.service.config.renderer)("src",o.service.formio.submissionUrl)},dependencies:[N]});let r=t;return r})();var Ne=(()=>{let t=class t{constructor(i,e,o,m,l){this.service=i,this.router=e,this.route=o,this.config=m,this.auth=l,this.onSuccess=new Q,this.onError=new Q,this.onSubmitDone=new Q,this.renderOptions={saveDraft:this.config.saveDraft},this.submission={data:{}}}onSubmit(i){this.router.navigate(["../","header"],{relativeTo:this.route})}};t.\u0275fac=function(e){return new(e||t)(n(b),n(_),n(h),n(we),n(W))},t.\u0275cmp=u({type:t,selectors:[["app-meo-view"]],decls:3,vars:1,consts:[[3,"submit","src"]],template:function(e,o){e&1&&(s(0,"p"),p(1,"meo-view works!"),a(),s(2,"formio",0),S("submit",function(l){return o.onSubmit(l)}),a()),e&2&&(d(2),f("src",o.service.formio.formUrl))},dependencies:[N]});let r=t;return r})();var Ve=(()=>{let t=class t{constructor(i,e){this.appConfig=i,this.excelService=e,this.services=[],this.forms=JSON.parse(localStorage.getItem("forms")??"[]"),this.keys=[],this.labels=[],this.row=[],this.rows=[],this.lot=localStorage.getItem("lot_no")||"noLot",this.query={params:{"data.lot1__eq":this.lot,limit:100,sort:"data.serial",skip:0}},this.sheetData=[],this.forms.forEach(o=>{let m=new R(this.appConfig.appUrl+"/form/"+o._id);this.services.push(m)})}CreateTable(i,e){let o=[],m=[],l=[],M;return i.components?.forEach(x=>{x.type!=="button"&&x.key!=="lot1"&&(o.push(x.key??""),m.push(x.label??""))}),e.forEach(x=>{let O=[];o.forEach(T=>{T!==void 0&&T!=="lot1"&&O.push(x.data[T])}),l.push(O)}),M={lot:this.lot,file_name:i.name||"",keys:o,labels:m,rows:l},M}ngOnInit(){this.services.forEach((i,e)=>{i.loadSubmissions(this.query).subscribe(o=>{this.sheetData.push(this.CreateTable(this.forms[e],o))})})}exportToExcel(){this.sheetData.sort((i,e)=>{let o=(i.file_name??"").toUpperCase(),m=(e.file_name??"").toUpperCase();return o<m?-1:o>m?1:0}),this.excelService.generateExcel(this.sheetData)}};t.\u0275fac=function(e){return new(e||t)(n(C),n(Me))},t.\u0275cmp=u({type:t,selectors:[["app-meo-excel"]],decls:2,vars:0,consts:[[3,"click"]],template:function(e,o){e&1&&(s(0,"button",0),S("click",function(){return o.exportToExcel()}),p(1,"Export to Excel"),a())}});let r=t;return r})();var ze=[{path:"",component:Ee,canActivate:[X]},{path:"lot",component:ke,pathMatch:"full",canActivate:[X]},{path:"lot/step/:id",component:Le,canActivate:[X],children:[{path:"",redirectTo:"header",pathMatch:"full"},{path:"header",component:Te,pathMatch:"full"},{path:"save",component:Ve},{path:"new",component:Ne},{path:"header/:id",component:De,children:[{path:"",redirectTo:"view",pathMatch:"full"},{path:"view",component:je},{path:"edit",component:Re},{path:"delete",component:Ie}]}]}],Oe=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=B({type:t}),t.\u0275inj=$({imports:[ce.forChild(ze),ce]});let r=t;return r})();var ei=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=B({type:t}),t.\u0275inj=$({imports:[Se,Oe,xe,be,ye,_e]});let r=t;return r})();export{ei as MeoModule};
