import{a as at,b as ut}from"./chunk-B2MMARM4.js";import{a as ot}from"./chunk-KBS7Z6M5.js";import"./chunk-JTUR66RW.js";import{E as Ie,P as st,a as rt,c as nt,p as Pe}from"./chunk-VCELUCMY.js";import{$b as Le,Bb as me,Da as Ce,Ea as we,Kb as ee,Lb as ce,Nb as Je,O as Re,Ob as Ge,Qb as De,Tb as Ee,Vb as Ae,Wc as Ye,Xc as et,Zc as tt,_b as ze,_c as it,ac as Me,bc as Xe,cc as ge,da as Te,dc as Ue,ec as Ze,f as mt,h as gt,hb as oe,ib as de,ja as pe,ka as ve,oa as Fe,oc as je,pc as Ne,s as Ke,ua as Ve,va as be,y as Qe,zb as xe}from"./chunk-G5GB6CLB.js";var lt=mt((qe,Be)=>{"use strict";(function(d,r){typeof define=="function"&&define.amd?define([],r):typeof Be=="object"&&typeof qe<"u"?Be.exports=r():d.Papa=r()})(qe,function d(){"use strict";var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},q=!r.document&&!!r.postMessage,n=r.IS_PAPA_WORKER||!1,o={},m=0,s={parse:function(t,e){var i=(e=e||{}).dynamicTyping||!1;if(k(i)&&(e.dynamicTypingFunction=i,i={}),e.dynamicTyping=i,e.transform=!!k(e.transform)&&e.transform,e.worker&&s.WORKERS_SUPPORTED){var a=function(){if(!s.WORKERS_SUPPORTED)return!1;var p=(M=r.URL||r.webkitURL||null,O=d.toString(),s.BLOB_URL||(s.BLOB_URL=M.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",O,")();"],{type:"text/javascript"})))),g=new r.Worker(p),M,O;return g.onmessage=_e,g.id=m++,o[g.id]=g}();return a.userStep=e.step,a.userChunk=e.chunk,a.userComplete=e.complete,a.userError=e.error,e.step=k(e.step),e.chunk=k(e.chunk),e.complete=k(e.complete),e.error=k(e.error),delete e.worker,void a.postMessage({input:t,config:e,workerId:a.id})}var l=null;return s.NODE_STREAM_INPUT,typeof t=="string"?(t=function(p){return p.charCodeAt(0)===65279?p.slice(1):p}(t),l=e.download?new H(e):new x(e)):t.readable===!0&&k(t.read)&&k(t.on)?l=new te(e):(r.File&&t instanceof File||t instanceof Object)&&(l=new B(e)),l.stream(t)},unparse:function(t,e){var i=!1,a=!0,l=",",p=`\r
`,g='"',M=g+g,O=!1,h=null,R=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||s.BAD_DELIMITERS.filter(function(u){return e.delimiter.indexOf(u)!==-1}).length||(l=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(i=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(O=e.skipEmptyLines),typeof e.newline=="string"&&(p=e.newline),typeof e.quoteChar=="string"&&(g=e.quoteChar),typeof e.header=="boolean"&&(a=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");h=e.columns}e.escapeChar!==void 0&&(M=e.escapeChar+g),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(R=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var f=new RegExp(V(g),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return J(null,t,O);if(typeof t[0]=="object")return J(h||Object.keys(t[0]),t,O)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||h),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),J(t.fields||[],t.data||[],O);throw new Error("Unable to serialize unrecognized input");function J(u,C,N){var S="";typeof u=="string"&&(u=JSON.parse(u)),typeof C=="string"&&(C=JSON.parse(C));var U=Array.isArray(u)&&0<u.length,z=!Array.isArray(C[0]);if(U&&a){for(var L=0;L<u.length;L++)0<L&&(S+=l),S+=j(u[L],L);0<C.length&&(S+=p)}for(var c=0;c<C.length;c++){var _=U?u.length:C[c].length,E=!1,A=U?Object.keys(C[c]).length===0:C[c].length===0;if(N&&!U&&(E=N==="greedy"?C[c].join("").trim()==="":C[c].length===1&&C[c][0].length===0),N==="greedy"&&U){for(var v=[],P=0;P<_;P++){var T=z?u[P]:P;v.push(C[c][T])}E=v.join("").trim()===""}if(!E){for(var b=0;b<_;b++){0<b&&!A&&(S+=l);var G=U&&z?u[b]:b;S+=j(C[c][G],b)}c<C.length-1&&(!N||0<_&&!A)&&(S+=p)}}return S}function j(u,C){if(u==null)return"";if(u.constructor===Date)return JSON.stringify(u).slice(1,25);var N=!1;R&&typeof u=="string"&&R.test(u)&&(u="'"+u,N=!0);var S=u.toString().replace(f,M);return(N=N||i===!0||typeof i=="function"&&i(u,C)||Array.isArray(i)&&i[C]||function(U,z){for(var L=0;L<z.length;L++)if(-1<U.indexOf(z[L]))return!0;return!1}(S,s.BAD_DELIMITERS)||-1<S.indexOf(l)||S.charAt(0)===" "||S.charAt(S.length-1)===" ")?g+S+g:S}}};if(s.RECORD_SEP="",s.UNIT_SEP="",s.BYTE_ORDER_MARK="\uFEFF",s.BAD_DELIMITERS=["\r",`
`,'"',s.BYTE_ORDER_MARK],s.WORKERS_SUPPORTED=!q&&!!r.Worker,s.NODE_STREAM_INPUT=1,s.LocalChunkSize=10485760,s.RemoteChunkSize=5242880,s.DefaultDelimiter=",",s.Parser=ue,s.ParserHandle=ae,s.NetworkStreamer=H,s.FileStreamer=B,s.StringStreamer=x,s.ReadableStreamStreamer=te,r.jQuery){var D=r.jQuery;D.fn.parse=function(t){var e=t.config||{},i=[];return this.each(function(p){if(!(D(this).prop("tagName").toUpperCase()==="INPUT"&&D(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var g=0;g<this.files.length;g++)i.push({file:this.files[g],inputElem:this,instanceConfig:D.extend({},e)})}),a(),this;function a(){if(i.length!==0){var p,g,M,O,h=i[0];if(k(t.before)){var R=t.before(h.file,h.inputElem);if(typeof R=="object"){if(R.action==="abort")return p="AbortError",g=h.file,M=h.inputElem,O=R.reason,void(k(t.error)&&t.error({name:p},g,M,O));if(R.action==="skip")return void l();typeof R.config=="object"&&(h.instanceConfig=D.extend(h.instanceConfig,R.config))}else if(R==="skip")return void l()}var f=h.instanceConfig.complete;h.instanceConfig.complete=function(J){k(f)&&f(J,h.file,h.inputElem),l()},s.parse(h.file,h.instanceConfig)}else k(t.complete)&&t.complete()}function l(){i.splice(0,1),a()}}}function w(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var i=Oe(e);i.chunkSize=parseInt(i.chunkSize),e.step||e.chunk||(i.chunkSize=null),this._handle=new ae(i),(this._handle.streamer=this)._config=i}).call(this,t),this.parseChunk=function(e,i){if(this.isFirstChunk&&k(this._config.beforeFirstChunk)){var a=this._config.beforeFirstChunk(e);a!==void 0&&(e=a)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+e;this._partialLine="";var p=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var g=p.meta.cursor;this._finished||(this._partialLine=l.substring(g-this._baseIndex),this._baseIndex=g),p&&p.data&&(this._rowCount+=p.data.length);var M=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)r.postMessage({results:p,workerId:s.WORKER_ID,finished:M});else if(k(this._config.chunk)&&!i){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!M||!k(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),M||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(e){k(this._config.error)?this._config.error(e):n&&this._config.error&&r.postMessage({workerId:s.WORKER_ID,error:e,finished:!1})}}function H(t){var e;(t=t||{}).chunkSize||(t.chunkSize=s.RemoteChunkSize),w.call(this,t),this._nextChunk=q?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(i){this._input=i,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),q||(e.onload=ie(this._chunkLoaded,this),e.onerror=ie(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!q),this._config.downloadRequestHeaders){var i=this._config.downloadRequestHeaders;for(var a in i)e.setRequestHeader(a,i[a])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{e.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}q&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(i){var a=i.getResponseHeader("Content-Range");return a===null?-1:parseInt(a.substring(a.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(i){var a=e.statusText||i;this._sendError(new Error(a))}}function B(t){var e,i;(t=t||{}).chunkSize||(t.chunkSize=s.LocalChunkSize),w.call(this,t);var a=typeof FileReader<"u";this.stream=function(l){this._input=l,i=l.slice||l.webkitSlice||l.mozSlice,a?((e=new FileReader).onload=ie(this._chunkLoaded,this),e.onerror=ie(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);l=i.call(l,this._start,p)}var g=e.readAsText(l,this._config.encoding);a||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(e.error)}}function x(t){var e;w.call(this,t=t||{}),this.stream=function(i){return e=i,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var i,a=this._config.chunkSize;return a?(i=e.substring(0,a),e=e.substring(a)):(i=e,e=""),this._finished=!e,this.parseChunk(i)}}}function te(t){w.call(this,t=t||{});var e=[],i=!0,a=!1;this.pause=function(){w.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){w.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){a&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):i=!0},this._streamData=ie(function(l){try{e.push(typeof l=="string"?l:l.toString(this._config.encoding)),i&&(i=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(p){this._streamError(p)}},this),this._streamError=ie(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=ie(function(){this._streamCleanUp(),a=!0,this._streamData("")},this),this._streamCleanUp=ie(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ae(t){var e,i,a,l=Math.pow(2,53),p=-l,g=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,M=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,O=this,h=0,R=0,f=!1,J=!1,j=[],u={data:[],errors:[],meta:{}};if(k(t.step)){var C=t.step;t.step=function(c){if(u=c,U())S();else{if(S(),u.data.length===0)return;h+=c.data.length,t.preview&&h>t.preview?i.abort():(u.data=u.data[0],C(u,O))}}}function N(c){return t.skipEmptyLines==="greedy"?c.join("").trim()==="":c.length===1&&c[0].length===0}function S(){return u&&a&&(L("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+s.DefaultDelimiter+"'"),a=!1),t.skipEmptyLines&&(u.data=u.data.filter(function(c){return!N(c)})),U()&&function(){if(!u)return;function c(E,A){k(t.transformHeader)&&(E=t.transformHeader(E,A)),j.push(E)}if(Array.isArray(u.data[0])){for(var _=0;U()&&_<u.data.length;_++)u.data[_].forEach(c);u.data.splice(0,1)}else u.data.forEach(c)}(),function(){if(!u||!t.header&&!t.dynamicTyping&&!t.transform)return u;function c(E,A){var v,P=t.header?{}:[];for(v=0;v<E.length;v++){var T=v,b=E[v];t.header&&(T=v>=j.length?"__parsed_extra":j[v]),t.transform&&(b=t.transform(b,T)),b=z(T,b),T==="__parsed_extra"?(P[T]=P[T]||[],P[T].push(b)):P[T]=b}return t.header&&(v>j.length?L("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+v,R+A):v<j.length&&L("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+v,R+A)),P}var _=1;return!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(c),_=u.data.length):u.data=c(u.data,0),t.header&&u.meta&&(u.meta.fields=j),R+=_,u}()}function U(){return t.header&&j.length===0}function z(c,_){return E=c,t.dynamicTypingFunction&&t.dynamicTyping[E]===void 0&&(t.dynamicTyping[E]=t.dynamicTypingFunction(E)),(t.dynamicTyping[E]||t.dynamicTyping)===!0?_==="true"||_==="TRUE"||_!=="false"&&_!=="FALSE"&&(function(A){if(g.test(A)){var v=parseFloat(A);if(p<v&&v<l)return!0}return!1}(_)?parseFloat(_):M.test(_)?new Date(_):_===""?null:_):_;var E}function L(c,_,E,A){var v={type:c,code:_,message:E};A!==void 0&&(v.row=A),u.errors.push(v)}this.parse=function(c,_,E){var A=t.quoteChar||'"';if(t.newline||(t.newline=function(T,b){T=T.substring(0,1048576);var G=new RegExp(V(b)+"([^]*?)"+V(b),"gm"),$=(T=T.replace(G,"")).split("\r"),X=T.split(`
`),Z=1<X.length&&X[0].length<$[0].length;if($.length===1||Z)return`
`;for(var W=0,I=0;I<$.length;I++)$[I][0]===`
`&&W++;return W>=$.length/2?`\r
`:"\r"}(c,A)),a=!1,t.delimiter)k(t.delimiter)&&(t.delimiter=t.delimiter(c),u.meta.delimiter=t.delimiter);else{var v=function(T,b,G,$,X){var Z,W,I,F;X=X||[",","	","|",";",s.RECORD_SEP,s.UNIT_SEP];for(var le=0;le<X.length;le++){var y=X[le],fe=0,Y=0,he=0;I=void 0;for(var re=new ue({comments:$,delimiter:y,newline:b,preview:10}).parse(T),ne=0;ne<re.data.length;ne++)if(G&&N(re.data[ne]))he++;else{var se=re.data[ne].length;Y+=se,I!==void 0?0<se&&(fe+=Math.abs(se-I),I=se):I=se}0<re.data.length&&(Y/=re.data.length-he),(W===void 0||fe<=W)&&(F===void 0||F<Y)&&1.99<Y&&(W=fe,Z=y,F=Y)}return{successful:!!(t.delimiter=Z),bestDelimiter:Z}}(c,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);v.successful?t.delimiter=v.bestDelimiter:(a=!0,t.delimiter=s.DefaultDelimiter),u.meta.delimiter=t.delimiter}var P=Oe(t);return t.preview&&t.header&&P.preview++,e=c,i=new ue(P),u=i.parse(e,_,E),S(),f?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,i.abort(),e=k(t.chunk)?"":e.substring(i.getCharIndex())},this.resume=function(){O.streamer._halted?(f=!1,O.streamer.parseChunk(e,!0)):setTimeout(O.resume,3)},this.aborted=function(){return J},this.abort=function(){J=!0,i.abort(),u.meta.aborted=!0,k(t.complete)&&t.complete(u),e=""}}function V(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ue(t){var e,i=(t=t||{}).delimiter,a=t.newline,l=t.comments,p=t.step,g=t.preview,M=t.fastMode,O=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(O=t.escapeChar),(typeof i!="string"||-1<s.BAD_DELIMITERS.indexOf(i))&&(i=","),l===i)throw new Error("Comment character same as delimiter");l===!0?l="#":(typeof l!="string"||-1<s.BAD_DELIMITERS.indexOf(l))&&(l=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var h=0,R=!1;this.parse=function(f,J,j){if(typeof f!="string")throw new Error("Input must be a string");var u=f.length,C=i.length,N=a.length,S=l.length,U=k(p),z=[],L=[],c=[],_=h=0;if(!f)return K();if(t.header&&!J){var E=f.split(a)[0].split(i),A=[],v={},P=!1;for(var T in E){var b=E[T];k(t.transformHeader)&&(b=t.transformHeader(b,T));var G=b,$=v[b]||0;for(0<$&&(P=!0,G=b+"_"+$),v[b]=$+1;A.includes(G);)G=G+"_"+$;A.push(G)}if(P){var X=f.split(a);X[0]=A.join(i),f=X.join(a)}}if(M||M!==!1&&f.indexOf(e)===-1){for(var Z=f.split(a),W=0;W<Z.length;W++){if(c=Z[W],h+=c.length,W!==Z.length-1)h+=a.length;else if(j)return K();if(!l||c.substring(0,S)!==l){if(U){if(z=[],he(c.split(i)),ke(),R)return K()}else he(c.split(i));if(g&&g<=W)return z=z.slice(0,g),K(!0)}}return K()}for(var I=f.indexOf(i,h),F=f.indexOf(a,h),le=new RegExp(V(O)+V(e),"g"),y=f.indexOf(e,h);;)if(f[h]!==e)if(l&&c.length===0&&f.substring(h,h+S)===l){if(F===-1)return K();h=F+N,F=f.indexOf(a,h),I=f.indexOf(i,h)}else if(I!==-1&&(I<F||F===-1))c.push(f.substring(h,I)),h=I+C,I=f.indexOf(i,h);else{if(F===-1)break;if(c.push(f.substring(h,F)),se(F+N),U&&(ke(),R))return K();if(g&&z.length>=g)return K(!0)}else for(y=h,h++;;){if((y=f.indexOf(e,y+1))===-1)return j||L.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:z.length,index:h}),ne();if(y===u-1)return ne(f.substring(h,y).replace(le,e));if(e!==O||f[y+1]!==O){if(e===O||y===0||f[y-1]!==O){I!==-1&&I<y+1&&(I=f.indexOf(i,y+1)),F!==-1&&F<y+1&&(F=f.indexOf(a,y+1));var fe=re(F===-1?I:Math.min(I,F));if(f.substr(y+1+fe,C)===i){c.push(f.substring(h,y).replace(le,e)),f[h=y+1+fe+C]!==e&&(y=f.indexOf(e,h)),I=f.indexOf(i,h),F=f.indexOf(a,h);break}var Y=re(F);if(f.substring(y+1+Y,y+1+Y+N)===a){if(c.push(f.substring(h,y).replace(le,e)),se(y+1+Y+N),I=f.indexOf(i,h),y=f.indexOf(e,h),U&&(ke(),R))return K();if(g&&z.length>=g)return K(!0);break}L.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:z.length,index:h}),y++}}else y++}return ne();function he(Q){z.push(Q),_=h}function re(Q){var We=0;if(Q!==-1){var Se=f.substring(y+1,Q);Se&&Se.trim()===""&&(We=Se.length)}return We}function ne(Q){return j||(Q===void 0&&(Q=f.substring(h)),c.push(Q),h=u,he(c),U&&ke()),K()}function se(Q){h=Q,he(c),c=[],F=f.indexOf(a,h)}function K(Q){return{data:z,errors:L,meta:{delimiter:i,linebreak:a,aborted:R,truncated:!!Q,cursor:_+(J||0)}}}function ke(){p(K()),z=[],L=[]}},this.abort=function(){R=!0},this.getCharIndex=function(){return h}}function _e(t){var e=t.data,i=o[e.workerId],a=!1;if(e.error)i.userError(e.error,e.file);else if(e.results&&e.results.data){var l={abort:function(){a=!0,He(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:$e,resume:$e};if(k(i.userStep)){for(var p=0;p<e.results.data.length&&(i.userStep({data:e.results.data[p],errors:e.results.errors,meta:e.results.meta},l),!a);p++);delete e.results}else k(i.userChunk)&&(i.userChunk(e.results,l,e.file),delete e.results)}e.finished&&!a&&He(e.workerId,e.results)}function He(t,e){var i=o[t];k(i.userComplete)&&i.userComplete(e),i.terminate(),delete o[t]}function $e(){throw new Error("Not implemented.")}function Oe(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var i in t)e[i]=Oe(t[i]);return e}function ie(t,e){return function(){t.apply(e,arguments)}}function k(t){return typeof t=="function"}return n&&(r.onmessage=function(t){var e=t.data;if(s.WORKER_ID===void 0&&e&&(s.WORKER_ID=e.workerId),typeof e.input=="string")r.postMessage({workerId:s.WORKER_ID,results:s.parse(e.input,e.config),finished:!0});else if(r.File&&e.input instanceof File||e.input instanceof Object){var i=s.parse(e.input,e.config);i&&r.postMessage({workerId:s.WORKER_ID,results:i,finished:!0})}}),(H.prototype=Object.create(w.prototype)).constructor=H,(B.prototype=Object.create(w.prototype)).constructor=B,(x.prototype=Object.create(x.prototype)).constructor=x,(te.prototype=Object.create(w.prototype)).constructor=te,s})});var _t=gt(lt(),1),ht=(()=>{let r=class r{constructor(){this._papa=_t}parse(n,o){return this._papa.parse(n,o)}unparse(n,o){return this._papa.unparse(n,o)}setLocalChunkSize(n){this._papa.LocalChunkSize=n}setRemoteChunkSize(n){this._papa.RemoteChunkSize=n}setDefaultDelimiter(n){this._papa.DefaultDelimiter=n}get badDelimiters(){return this._papa.BAD_DELIMITERS}get recordSeparator(){return this._papa.RECORD_SEP}get unitSeparator(){return this._papa.UNIT_SEP}get workersSupported(){return this._papa.WORKERS_SUPPORTED}};r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=pe({token:r,factory:r.\u0275fac,providedIn:"root"});let d=r;return d})();var ct=(()=>{let r=class r{constructor(n,o){this.appConfig=n,this.http=o}uploadForm(n){let o=this.appConfig.appUrl+"/form",m=localStorage.getItem("formioToken")||"",s=new rt({"Content-Type":"application/json","x-jwt-token":m});return this.http.post(o,n,{headers:s})}failingRequest(){this.http.get("https://httpstat.us/404?sleep=2000").toPromise()}};r.\u0275fac=function(o){return new(o||r)(Fe(Ie),Fe(nt))},r.\u0275prov=pe({token:r,factory:r.\u0275fac,providedIn:"root"});let d=r;return d})();var ft=(()=>{let r=class r{constructor(){}generateForm(n,o,m){let s={type:"button",action:"submit",label:"Submit",theme:"primary"},D=this.setTextfield("user");D.customDefaultValue="value = user.data.email;",D.disabled=!0;let w=this.setTextfield("lot");w.key="lot1",w.disabled=!0;let H=this.setNumber("serial","","serial");H.label="serial",H.key="serial";let B={title:n.Cikksz\u00E1m+" ("+n.Megnevez\u00E9s+")",display:"form",type:"form",name:n.Cikksz\u00E1m,path:n.Cikksz\u00E1m,tags:["common"],components:[D,w,H],access:[o],submissionAccess:m};for(let x=0;x<Object.keys(n).length/3;x++)n["Tp-"+x]==="n"?B.components?.push(this.setNumber(n["Par-"+x],n["Tr-"+x],x,n["No-"+x],n["Mi-"+x],n["Pl-"+x])):n["Tp-"+x]==="b"&&B.components?.push(this.setCheckbox(n["Par-"+x],n["Tr-"+x],x));return B.components?.push(s),B}generateHeaderForm(n,o,m,s){let D={type:"button",action:"submit",label:"Submit",theme:"primary"},w=this.setTextfield("user");w.customDefaultValue="value = user.data.email;",w.disabled=!0;let H=this.setNumber("serial","","serial");H.label="serial",H.key="serial";let B=this.setTextfield("lot");if(B.key="lot1",B.disabled=!0,!n||!("Cikksz\xE1m"in n))return console.error("Invalid nfdata input",n),{};let x={display:"form",type:"form",name:n.Cikksz\u00E1m.substring(0,n.Cikksz\u00E1m.indexOf("xx"))+"xxH",path:n.Cikksz\u00E1m.substring(0,n.Cikksz\u00E1m.indexOf("xx"))+"xxH",title:n.Cikksz\u00E1m.substring(0,n.Cikksz\u00E1m.indexOf("xx"))+"xxH",tags:["common"],components:[w,H,B],access:[m],submissionAccess:s};return o.forEach((te,ae)=>{let V="NH";te.Cikksz\u00E1m?.includes("xx")&&(V=te.Cikksz\u00E1m.substring(te.Cikksz\u00E1m.indexOf("xx")+2));let ue=this.setNumber("aa"+ae,"In",ae);ue.label="In-"+V,ue.key="In"+V;let _e=this.setNumber("#"+ae,"Out",ae);_e.label="Out-"+V,_e.key="Out"+V,x.components?.push(ue,_e)}),x.components?.push(D),x}setTextfield(n){return{type:"textfield",label:n,key:n,input:!0,hidden:!1,disabled:!1,customDefaultValue:""}}setCheckbox(n,o,m){return{label:`${n} (${o})`,tableView:!0,key:"par"+m,type:"checkbox",input:!0}}setNumber(n,o,m,s,D,w){return{input:!0,tableView:!0,inputType:"number",label:`${n} (${o})`,key:"par"+m,type:"number",properties:{nominalValue:s,toleranceMin:D,toleranceMax:w}}}};r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=pe({token:r,factory:r.\u0275fac,providedIn:"root"});let d=r;return d})();var Ct=["template"],wt=["csvInput"];function xt(d,r){if(d&1){let q=De();ee(0,"button",3),Ee("click",function(){Ce(q);let o=Ae();return we(o.uploadForms())}),ge(1," Upload Form "),ce()}}function Et(d,r){if(d&1&&(ee(0,"div",4),ge(1),je(2,"json"),ce()),d&2){let q=r.$implicit;oe(),Ue(Ne(2,1,q))}}function It(d,r){if(d&1&&(ee(0,"div",4),ge(1),je(2,"json"),ce()),d&2){let q=r.$implicit;oe(),Ue(Ne(2,1,q))}}function Ot(d,r){if(d&1&&(Je(0),xe(1,It,3,3,"div",6),Ge()),d&2){let q=Ae();oe(),me("ngForOf",q.errorMessages)}}var pt=(()=>{let r=class r{constructor(n,o,m,s,D){this.appConfig=n,this.papa=o,this.upload=m,this.auth=s,this.formBuilder=D,this.template=null,this.fileName="",this.dataList=[],this.errorMessages=[],this.roles=[],this.subForms=[],this.destroy$=new Ke,this.accessSetting={type:"read_all",roles:[]},this.submissionAccess=[{type:"read_all",roles:[]},{type:"create_own",roles:[]},{type:"read_own",roles:[]},{type:"update_own",roles:[]},{type:"delete_own",roles:[]}]}ngOnInit(){this.auth.ready.then(()=>{let{administrator:n,authenticated:o,anonymous:m}=this.auth.roles;this.roles.push(n._id,o._id,m._id),this.accessSetting.roles=this.roles,this.submissionAccess.forEach(s=>s.roles.push(o._id))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),console.log("UploadComponent destroyed.")}onFileSelected(n){let o=n.target,m=o.files?.[0];this.errorMessages=[],m&&(this.fileName=m.name,this.parseCsvFile(m),o.value="")}parseCsvFile(n){this.papa.parse(n,{header:!0,dynamicTyping:!0,skipEmptyLines:"greedy",worker:!0,complete:o=>this.handleParsedCsv(o)})}handleParsedCsv(n){this.dataList=n.data}uploadForms(){if(!this.dataList.length)return;let n=this.dataList.filter(o=>String(o.Cikksz\u00E1m).includes("XX"));this.dataList.forEach(o=>o.Cikksz\u00E1m=o.Cikksz\u00E1m.toLowerCase());for(let o of n){let m=this.dataList.filter(s=>s.Cikksz\u00E1m.startsWith(o.Cikksz\u00E1m.substring(0,o.Cikksz\u00E1m.indexOf("xx"))));for(let s of m)this.formToUpload=this.formBuilder.generateForm(s,this.accessSetting,this.submissionAccess),this.upload.uploadForm(this.formToUpload).pipe(Re(D=>this.handleUploadError(D,s.Cikksz\u00E1m)),Te(this.destroy$)).subscribe();if(!m||m.some(s=>!("Cikksz\xE1m"in s))){console.error("Invalid subForms input",m);return}this.headerFormToUpload=this.formBuilder.generateHeaderForm(m[0],m,this.accessSetting,this.submissionAccess),this.upload.uploadForm(this.headerFormToUpload).pipe(Re(s=>this.handleUploadError(s,o.Cikksz\u00E1m)),Te(this.destroy$)).subscribe()}this.dataList=[],this.fileName=""}handleUploadError(n,o){let m=n.status===0?`${o} client-side/network error`:`${o} backend error: ${n.status} - ${n.error?.message}`;return this.errorMessages.push(m),console.error(m,n),Qe(`${o} - upload error`)}};r.\u0275fac=function(o){return new(o||r)(de(Ie),de(ht),de(ct),de(st),de(ft))},r.\u0275cmp=Ve({type:r,selectors:[["app-upload"]],viewQuery:function(o,m){if(o&1&&(ze(Ct,5),ze(wt,5)),o&2){let s;Le(s=Me())&&(m.template=s.first),Le(s=Me())&&(m.csvInput=s.first)}},decls:11,vars:5,consts:[["fileUpload",""],["type","file",1,"file-input",3,"change","accept"],[1,"file-upload"],[1,"btn","btn-primary",3,"click"],[1,"mt-2","col-md-12"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","mt-2 col-md-12",4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(o,m){if(o&1){let s=De();ee(0,"input",1,0),Ee("change",function(w){return Ce(s),we(m.onFileSelected(w))}),ce(),ee(2,"div",2),ge(3),ee(4,"button",3),Ee("click",function(){Ce(s);let w=Xe(1);return we(w.click())}),ee(5,"mat-icon"),ge(6,"attach_file"),ce()()(),ee(7,"div",4),xe(8,xt,2,0,"button",5),ce(),xe(9,Et,3,3,"div",6)(10,Ot,2,1,"ng-container",7)}o&2&&(me("accept","text/csv"),oe(3),Ze(" ",m.fileName||"No file chosen"," "),oe(5),me("ngIf",m.dataList),oe(),me("ngForOf",m.dataList),oe(),me("ngIf",m.errorMessages))},dependencies:[Ye,et,at,tt],styles:[".file-input[_ngcontent-%COMP%]{display:none}"]});let d=r;return d})();var St=[{path:"",component:pt,canActivate:[ot]}],dt=(()=>{let r=class r{};r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=be({type:r}),r.\u0275inj=ve({imports:[Pe.forChild(St),Pe]});let d=r;return d})();var Wt=(()=>{let r=class r{};r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=be({type:r}),r.\u0275inj=ve({imports:[it,dt,ut]});let d=r;return d})();export{Wt as UploadModule};
