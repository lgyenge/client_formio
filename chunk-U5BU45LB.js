import{a as we}from"./chunk-IBPJJ2QQ.js";import{b as Ie}from"./chunk-EBPMJSX6.js";import{b as xe,c as x,h as ye}from"./chunk-POD6NK3B.js";import{a as ee,b as te,c as ie,e as oe,f as re,g as ne,j as se,k as Se,l as Ce,o as ae,p as be}from"./chunk-HUEVTG4Z.js";import{A as de,B as Q,Eb as N,F as u,G as P,Gb as ge,Hb as _e,Jb as Z,K as w,L as M,P as z,Sa as W,Ta as L,U as l,V as n,Xa as ve,ba as S,da as d,db as h,eb as R,fb as C,ga as s,gb as X,ha as a,hb as Y,ia as g,ib as ce,j as U,k as le,ka as E,la as _,ma as v,pa as K,ra as fe,s as $,sa as ue,t as J,ta as he,v as B,va as p,w as V,x as H,xa as k,xb as b,yb as D}from"./chunk-5QQL34UD.js";function Oe(r,e){if(r&1){let c=E();s(0,"tr",11),_("click",function(){let t=w(c),o=t.$implicit,m=t.index,f=v();return M(f.ClickedRow(m,o))}),s(1,"td"),p(2),a(),s(3,"td"),p(4),a(),s(5,"td"),p(6),a()()}if(r&2){let c=e.$implicit;l(2),k(" ",c.title," "),l(2),k(" ",c.name," "),l(2),k(" ",c.modified," ")}}var Me=(()=>{let e=class e{constructor(i,t,o,m){this.appConfig=i,this.fb=t,this.route=o,this.router=m,this.userSearchResults=[],this.userDisplayResults=[],this.form_ids=[],this.destroy$=new U,this.service=new D(this.appConfig.appUrl)}ClickedRow(i,t){localStorage.setItem("form_id",this.userDisplayResults[i]._id??""),this.FindStep(1,t),this.router.navigate(["lot"],{relativeTo:this.route})}FindStep(i,t){let m={params:{name__regex:"/"+t.name+"/i",tags__eq:["common"],type:"form"}};this.service.loadForms(m).pipe(V(this.destroy$)).subscribe(f=>{let F=f;F.sort((y,G)=>{let j=(y.name??"").toUpperCase(),pe=(G.name??"").toUpperCase();return j<pe?-1:j>pe?1:0}),F.forEach(y=>{y._id&&this.form_ids.push(y._id)}),localStorage.setItem("forms",JSON.stringify(F))})}ngOnInit(){this.searchForm=this.fb.group({name:[""]}),this.searchForm.get("name")?.valueChanges.pipe(J(400),$(i=>i.length>2),H({next:i=>{localStorage.setItem("meo_query",JSON.stringify({params:{title__regex:"/"+i+"/i",tags__eq:["common"],type:"form"}})),localStorage.setItem("meo_searchInput",i)}}),B(i=>this.service.loadForms(JSON.parse(localStorage.getItem("meo_query")||"{}"))),V(this.destroy$)).subscribe(i=>{this.userSearchResults=i,this.userDisplayResults=i.filter(t);function t(o){return o.name,o.name&&!(o.name.substring(o.name.length-2,o.name.length)==="x1"||o.name.substring(o.name.length-2,o.name.length)==="x2"||o.name.substring(o.name.length-2,o.name.length)==="x3")}})}};e.\u0275fac=function(t){return new(t||e)(n(b),n(se),n(h),n(C))},e.\u0275cmp=u({type:e,selectors:[["app-meo"]],decls:18,vars:2,consts:[[3,"formGroup"],[1,"mb-3"],["formControlName","name","placeholder","Search Implant",1,"form-control"],[1,"row","mt-3"],[1,"col"],[1,"table-responsive"],[1,"table","table-hover"],[1,"thead-light"],["width","150"],["width","150",1,"text-center"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,o){t&1&&(g(0,"router-outlet"),s(1,"form",0)(2,"div",1),g(3,"input",2),a()(),s(4,"div",3)(5,"div",4)(6,"div",5)(7,"table",6)(8,"thead",7)(9,"tr")(10,"th"),p(11,"Title"),a(),s(12,"th",8),p(13,"Name"),a(),s(14,"th",9),p(15,"Modified"),a()()(),s(16,"tbody"),S(17,Oe,7,3,"tr",10),a()()()()()),t&2&&(l(),d("formGroup",o.searchForm),l(16),d("ngForOf",o.userDisplayResults))},dependencies:[W,R,oe,ee,te,ie,re,ne]});let r=e;return r})();function qe(r,e){if(r&1){let c=E();s(0,"tr",11),_("click",function(){let t=w(c),o=t.$implicit,m=t.index,f=v();return M(f.ClickedRow(m,o))}),s(1,"td"),p(2),a(),s(3,"td"),p(4),a(),s(5,"td"),p(6),a()()}if(r&2){let c=e.$implicit;l(2),k(" ",c.data.lot," "),l(2),k(" ",c.data.description," "),l(2),k(" ",c.data.inproduction," ")}}var Fe=(()=>{let e=class e{constructor(i,t,o,m){this.appConfig=i,this.fb=t,this.route=o,this.router=m,this.userSearchResults=[],this.form_id="",this.url=this.appConfig.appUrl+"/form/"+Ie.lotId+"/submission",this.destroy$=new U,this.service=new D(this.url)}ClickedRow(i,t){localStorage.setItem("lot_no",this.userSearchResults[i].data.lot),this.form_id=localStorage.getItem("form_id"),this.router.navigate(["step",this.form_id],{relativeTo:this.route})}ngOnInit(){this.searchForm=this.fb.group({lot:[""]}),this.searchForm.get("lot")?.valueChanges.pipe(J(400),$(i=>i.length>1),H({next:i=>{localStorage.setItem("meo_lot_query",JSON.stringify({params:{"data.lot__regex":"/"+i+"/i",type:"resource"}})),localStorage.setItem("meo_lot_searchInput",i)}}),B(i=>this.service.loadSubmissions(JSON.parse(localStorage.getItem("meo_lot_query")||"{}"))),V(this.destroy$)).subscribe(i=>{this.userSearchResults=i})}};e.\u0275fac=function(t){return new(t||e)(n(b),n(se),n(h),n(C))},e.\u0275cmp=u({type:e,selectors:[["app-meo-lot"]],decls:17,vars:2,consts:[[3,"formGroup"],[1,"mb-3"],["formControlName","lot","placeholder","Search Lot No",1,"form-control"],[1,"row","mt-3"],[1,"col"],[1,"table-responsive"],[1,"table","table-hover"],[1,"thead-light"],["width","550"],["width","100",1,"text-center"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,o){t&1&&(s(0,"form",0)(1,"div",1),g(2,"input",2),a()(),s(3,"div",3)(4,"div",4)(5,"div",5)(6,"table",6)(7,"thead",7)(8,"tr")(9,"th"),p(10,"Lot number"),a(),s(11,"th",8),p(12,"Description"),a(),s(13,"th",9),p(14,"Production"),a()()(),s(15,"tbody"),S(16,qe,7,3,"tr",10),a()()()()()),t&2&&(d("formGroup",o.searchForm),l(16),d("ngForOf",o.userSearchResults))},dependencies:[W,oe,ee,te,ie,re,ne]});let r=e;return r})();var me=(()=>{let e=class e{constructor(){this.message=new le("Initial message!!!"),this.getMessage=this.message.asObservable()}sendMessage(i){this.message.next(i)}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=de({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function Ue(r,e){if(r&1&&(s(0,"li",4)(1,"a",5),p(2," #1"),a()()),r&2){let c=v();l(),K("routerLink",c.header1)}}function $e(r,e){if(r&1&&(s(0,"li",4)(1,"a",5),p(2," #2"),a()()),r&2){let c=v();l(),K("routerLink",c.header2)}}function Je(r,e){r&1&&(s(0,"li",4)(1,"a",8),p(2,"Excel"),a()())}var ke=(()=>{let e=class e{updateForm(i){this.dataService.sendMessage(i)}constructor(i,t,o,m,f,F){this.service=i,this.auth=t,this.route=o,this.appConfig=m,this.router=f,this.dataService=F,this.forms=JSON.parse(localStorage.getItem("forms")??"[]"),this.header="/meo/lot/step/"+this.forms[0]._id+"/header",this.header1="/meo/lot/step/"+this.forms[1]?._id+"/header",this.header2="/meo/lot/step/"+this.forms[2]?._id+"/header"}ngOnInit(){this.route.params.subscribe(i=>{this.updateForm(i.id)}),this.service.reset(this.route)}};e.\u0275fac=function(t){return new(t||e)(n(x),n(Z),n(h),n(b),n(C),n(me))},e.\u0275cmp=u({type:e,selectors:[["app-meo-step"]],decls:14,vars:4,consts:[["aria-label","Submission","role","navigation",1,"nav","nav-tabs",2,"margin-bottom","10px"],[1,"nav-item"],["routerLink","../../",1,"nav-link"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"],["routerLinkActive","active",1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"],["class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","new","routerLinkActive","active",1,"nav-link"],["routerLink","save","routerLinkActive","active",1,"nav-link"]],template:function(t,o){t&1&&(s(0,"ul",0)(1,"li",1)(2,"a",2),g(3,"em",3),a()(),s(4,"li",4)(5,"a",5),p(6," #0"),a()(),S(7,Ue,3,1,"li",6)(8,$e,3,1,"li",6)(9,Je,3,0,"li",6),s(10,"li",4)(11,"a",7),p(12,"New"),a()()(),g(13,"router-outlet")),t&2&&(l(5),K("routerLink",o.header),l(2),d("ngIf",o.forms[1]==null?null:o.forms[1]._id),l(),d("ngIf",o.forms[2]==null?null:o.forms[2]._id),l(),d("ngIf",o.auth.is.administrator))},dependencies:[L,R,X,Y]});let r=e;return r})();function Be(r,e){if(r&1){let c=E();s(0,"formio-grid",1),_("rowAction",function(t){w(c);let o=v();return M(o.onAction(t))})("rowSelect",function(t){w(c);let o=v();return M(o.onSelect(t))}),a()}if(r&2){let c=v();d("formio",c.serviceFormioConverted)("query",c.query)("isActionAllowed",c.service.actionAllowed)}}var Le=(()=>{let e=class e{constructor(i,t,o,m,f){this.route=i,this.router=t,this.service=o,this.dataService=m,this.appConfig=f,this.query={"data.lot1__eq":localStorage.getItem("lot_no")},this.msg="674df6f4b9e053f61d9102e9",this.serviceFormioConverted=this.service.formio}ngOnDestroy(){this.subscription?.unsubscribe()}ngOnInit(){this.subscription=this.dataService.getMessage.subscribe(i=>{this.msg=i,this.service.ready.then(()=>{this.formGrid.formio=new _e.Formio(this.appConfig.appUrl+"/form/"+i),this.formGrid.refreshGrid(this.query)})})}onSelect(i){this.router.navigate([i._id,"view"],{relativeTo:this.route})}onAction(i){this.service.form=null,this.router.navigate([i.row._id,i.action],{relativeTo:this.route})}onCreateItem(){this.router.navigate(["create"],{relativeTo:this.route})}isActionAllowed(i){return!0}};e.\u0275fac=function(t){return new(t||e)(n(h),n(C),n(x),n(me),n(b))},e.\u0275cmp=u({type:e,selectors:[["app-meo-step-index"]],viewQuery:function(t,o){if(t&1&&fe(ae,5),t&2){let m;ue(m=he())&&(o.formGrid=m.first)}},decls:1,vars:1,consts:[[3,"formio","query","isActionAllowed","rowAction","rowSelect",4,"ngIf"],[3,"rowAction","rowSelect","formio","query","isActionAllowed"]],template:function(t,o){t&1&&S(0,Be,1,3,"formio-grid",0),t&2&&d("ngIf",o.service.ready)},dependencies:[L,ae]});let r=e;return r})();function He(r,e){if(r&1){let c=E();s(0,"formio",1),_("formLoad",function(t){w(c);let o=v();return M(o.service.setForm(t))})("submissionLoad",function(t){w(c);let o=v();return M(o.service.submissionLoaded(t))}),a()}if(r&2){let c=v();d("renderer",c.service.config.renderer)("src",c.service.formio.submissionUrl)("readOnly",!0)}}var Ae=(()=>{let e=class e{constructor(i,t,o){this.service=i,this.route=t,this.appConfig=o}};e.\u0275fac=function(t){return new(t||e)(n(x),n(h),n(b))},e.\u0275cmp=u({type:e,selectors:[["app-meo-step-view"]],decls:1,vars:1,consts:[[3,"renderer","src","readOnly","formLoad","submissionLoad",4,"ngIf"],[3,"formLoad","submissionLoad","renderer","src","readOnly"]],template:function(t,o){t&1&&S(0,He,1,3,"formio",0),t&2&&d("ngIf",!0)},dependencies:[L,N]});let r=e;return r})();function Qe(r,e){r&1&&(s(0,"li",4)(1,"a",8),g(2,"em",9),p(3," Edit"),a()())}function Pe(r,e){r&1&&(s(0,"li",4)(1,"a",10),g(2,"span",11),a()())}var Te=(()=>{let e=class e{constructor(i,t){this.service=i,this.route=t}ngOnInit(){this.service.setSubmission(this.route).then(i=>{})}};e.\u0275fac=function(t){return new(t||e)(n(x),n(h))},e.\u0275cmp=u({type:e,selectors:[["app-meo-step-header"]],decls:11,vars:2,consts:[["aria-label","Submission","role","navigation",1,"nav","nav-tabs",2,"margin-bottom","10px"],[1,"nav-item"],["routerLink","../",1,"nav-link"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"],["routerLinkActive","active",1,"nav-item"],["routerLink","view","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-eye","bi","bi-eye"],["class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","edit","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-edit","bi","bi-pencil-square"],["routerLink","delete","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-trash","bi","bi-trash"]],template:function(t,o){t&1&&(s(0,"ul",0)(1,"li",1)(2,"a",2),g(3,"em",3),a()(),s(4,"li",4)(5,"a",5),g(6,"em",6),p(7," View"),a()(),S(8,Qe,4,0,"li",7)(9,Pe,3,0,"li",7),a(),g(10,"router-outlet")),t&2&&(l(8),d("ngIf",o.service.perms.edit),l(),d("ngIf",o.service.perms.delete))},dependencies:[L,R,X,Y]});let r=e;return r})();var je=(()=>{let e=class e{constructor(i,t,o){this.service=i,this.router=t,this.route=o}onSubmit(i){this.router.navigate(["../../"],{relativeTo:this.route})}};e.\u0275fac=function(t){return new(t||e)(n(x),n(C),n(h))},e.\u0275cmp=u({type:e,selectors:[["app-meo-step-edit"]],decls:1,vars:2,consts:[[3,"submit","formLoad","submissionLoad","renderer","src"]],template:function(t,o){t&1&&(s(0,"formio",0),_("submit",function(f){return o.onSubmit(f)})("formLoad",function(f){return o.service.setForm(f)})("submissionLoad",function(f){return o.service.submissionLoaded(f)}),a()),t&2&&d("renderer",o.service.config.renderer)("src",o.service.formio.submissionUrl)},dependencies:[N]});let r=e;return r})();var Re=(()=>{let e=class e{constructor(i,t,o,m,f){this.service=i,this.router=t,this.route=o,this.config=m,this.auth=f,this.onSuccess=new z,this.onError=new z,this.onSubmitDone=new z,this.renderOptions={saveDraft:this.config.saveDraft},this.submission={data:{}}}onSubmit(i){this.router.navigate(["../","header"],{relativeTo:this.route})}};e.\u0275fac=function(t){return new(t||e)(n(x),n(C),n(h),n(xe),n(Z))},e.\u0275cmp=u({type:e,selectors:[["app-meo-view"]],decls:3,vars:1,consts:[[3,"submit","src"]],template:function(t,o){t&1&&(s(0,"p"),p(1,"meo-view works!"),a(),s(2,"formio",0),_("submit",function(f){return o.onSubmit(f)}),a()),t&2&&(l(2),d("src",o.service.formio.formUrl))},dependencies:[N]});let r=e;return r})();var De=(()=>{let e=class e{constructor(i,t){this.appConfig=i,this.excelService=t,this.services=[],this.query=JSON.parse(localStorage.getItem("meo_query")||"{}"),this.forms=JSON.parse(localStorage.getItem("forms")??"[]"),this.keys=[],this.labels=[],this.row=[],this.rows=[],this.lot=localStorage.getItem("lot_no")||"noLot",this.sheetData=[],this.forms.forEach(o=>{let m=new D(this.appConfig.appUrl+"/form/"+o._id);this.services.push(m)})}CreateTable(i,t){let o=[],m=[],f=[],F;return i.components?.forEach(y=>{y.type!=="button"&&y.key!=="lot1"&&(o.push(y.key??""),m.push(y.label??""))}),t.forEach(y=>{let G=[];o.forEach(j=>{j!==void 0&&j!=="lot1"&&G.push(y.data[j])}),f.push(G)}),F={lot:this.lot,file_name:i.name||"",keys:o,labels:m,rows:f},F}ngOnInit(){this.services.forEach((i,t)=>{i.loadSubmissions(this.query).subscribe(o=>{this.sheetData.push(this.CreateTable(this.forms[t],o))})})}exportToExcel(){this.sheetData.sort((i,t)=>{let o=(i.file_name??"").toUpperCase(),m=(t.file_name??"").toUpperCase();return o<m?-1:o>m?1:0}),this.excelService.generateExcel(this.sheetData)}};e.\u0275fac=function(t){return new(t||e)(n(b),n(we))},e.\u0275cmp=u({type:e,selectors:[["app-meo-excel"]],decls:2,vars:0,consts:[[3,"click"]],template:function(t,o){t&1&&(s(0,"button",0),_("click",function(){return o.exportToExcel()}),p(1,"Export to Excel"),a())}});let r=e;return r})();var ze=[{path:"",component:Me},{path:"lot",component:Fe,pathMatch:"full"},{path:"lot/step/:id",component:ke,children:[{path:"",redirectTo:"header",pathMatch:"full"},{path:"header",component:Le,pathMatch:"full"},{path:"save",component:De},{path:"new",component:Re},{path:"header/:id",component:Te,children:[{path:"",redirectTo:"view",pathMatch:"full"},{path:"view",component:Ae},{path:"edit",component:je},{path:"delete",component:ye}]}]}],Ne=(()=>{let e=class e{};e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=P({type:e}),e.\u0275inj=Q({imports:[ce.forChild(ze),ce]});let r=e;return r})();var Yt=(()=>{let e=class e{};e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=P({type:e}),e.\u0275inj=Q({imports:[ve,Ne,Ce,Se,be,ge]});let r=e;return r})();export{Yt as MeoModule};
