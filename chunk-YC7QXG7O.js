import{t as G}from"./chunk-YS2H75DU.js";import{D as H,E as V,G as D,I as Y,K as q,L as I,P as k,j as Z,k as g,l as z,m as y,n as L,o as Q,q as B}from"./chunk-LK7GDLPJ.js";import{Bb as u,Dc as $,Kb as c,Lb as s,Ma as d,Mb as l,Tb as v,Vb as N,Xc as E,cc as f,ec as x,h as O,hb as p,ib as o,ja as F,oa as b,qb as P,ua as h,zb as j}from"./chunk-CHBFHPN6.js";var m=O(H(),1),w=O(B(),1);function J(t,T){t&1&&(c(0,"li",4)(1,"a",7),f(2,"Edit"),s()())}function K(t,T){t&1&&(c(0,"li",4)(1,"a",8),l(2,"span",9),s()())}function W(t,T){if(t&1&&(c(0,"h3",2)(1,"a",3),l(2,"em",4),s(),f(3),s()),t&2){let e=N();p(3),x(" | New ",e.service.form.title,`
`)}}var C=(()=>{class t{name="";form="";parents=[];static \u0275fac=function(r){return new(r||t)};static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})(),X=(()=>{class t{auth;resources={};error;onError;constructor(e){this.auth=e,this.error=new d,this.onError=this.error,this.resources={currentUser:{resourceLoaded:this.auth.userReady}}}static \u0275fac=function(r){return new(r||t)(b(k))};static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})(),R=(()=>{class t{appConfig;config;resourcesService;initialized=!1;form;alerts;resource;resourceUrl;formUrl;formFormio;formio;refresh;resourceResolve;resourceReject;resourceLoaded;resourceLoading;resourceId;resources;ready;readyResolve;readyReject;formLoading;formLoaded;formResolve;formReject;isLoading;constructor(e,r,i){this.appConfig=e,this.config=r,this.resourcesService=i,this.isLoading=!0,this.alerts=new Y,this.refresh=new d}initialize(){console.warn("FormioResourceService.initialize() has been deprecated.")}setResource(e){this.resourceLoading=null,this.formLoading=null,this.ready=new Promise((r,i)=>{this.readyResolve=r,this.readyReject=i}),this.formLoaded=new Promise((r,i)=>{this.formResolve=r,this.formReject=i}),this.resourceLoaded=new Promise((r,i)=>{this.resourceResolve=r,this.resourceReject=i}),this.resourceId=e,this.resourceUrl=this.appConfig.appUrl+"/"+this.config.form,this.resourceId&&(this.resourceUrl+="/submission/"+this.resourceId),this.appConfig&&this.appConfig.appUrl?(m.Formio.setBaseUrl(this.appConfig.apiUrl),m.Formio.setProjectUrl(this.appConfig.appUrl),m.Formio.formOnly=this.appConfig.formOnly):console.error("You must provide an AppConfig within your application!"),this.formio=new D(this.resourceUrl),this.resource={data:{}}}init(e){let r=e.snapshot.params.id;return r&&r===this.resourceId?this.ready:(this.setResource(r),this.resourcesService&&(this.resources=this.resourcesService.resources,this.resources[this.config.name]=this),this.resourceId?this.loadForm().then(()=>this.loadResource()).then(()=>this.readyResolve(this.form)).catch(i=>this.readyReject(i)):this.loadForm().then(()=>this.readyResolve(this.form)).catch(i=>this.readyReject(i)))}onError(e){throw this.alerts.setAlert({type:"danger",message:e.message||e}),this.resourcesService&&this.resourcesService.error.emit(e),e}onFormError(e){this.formReject(e),this.onError(e)}loadForm(){return this.formLoading?this.formLoading:(this.formUrl=this.appConfig.appUrl+"/"+this.config.form,this.formFormio=new D(this.formUrl),this.isLoading=!0,this.formLoading=this.formFormio.loadForm().then(e=>(this.form=e,this.formResolve(e),this.isLoading=!1,this.loadParents(),e),e=>this.onFormError(e)).catch(e=>this.onFormError(e)),this.formLoading)}loadParents(){return!this.config.parents||!this.config.parents.length?Promise.resolve([]):this.resourcesService?this.formLoading.then(e=>{let r=[];return this.config.parents.forEach(i=>{let n=i.resource||i,a=i.field||i,S=i.hasOwnProperty("filter")?i.filter:!0;this.resources.hasOwnProperty(n)&&this.resources[n].resourceLoaded&&r.push(this.resources[n].resourceLoaded.then(M=>{let A="";return m.Utils.eachComponent(e.components,(_,U)=>{if(_.key===a)return _.hidden=!0,_.clearOnHide=!1,w.default.set(this.resource.data,U,M),A=U,!0}),{name:A,filter:S,resource:M}}))}),Promise.all(r).then(i=>(this.refresh.emit({form:e,submission:this.resource}),i))}):(console.warn("You must provide the FormioResources within your application to use nested resources."),Promise.resolve([]))}onSubmissionError(e){this.onError(e),this.resourceReject(e)}loadResource(){return this.resourceLoading?this.resourceLoading:(this.isLoading=!0,this.resourceLoading=this.formio.loadSubmission(null,{ignoreCache:!0}).then(e=>(this.resource=e,this.isLoading=!1,this.refresh.emit({property:"submission",value:this.resource}),this.resourceResolve(e),e),e=>this.onSubmissionError(e)).catch(e=>this.onSubmissionError(e)),this.resourceLoading)}save(e){return(e._id?this.formio:this.formFormio).saveSubmission(e).then(i=>(this.resource=i,i),i=>this.onError(i)).catch(i=>this.onError(i))}remove(){return this.formio.deleteSubmission().then(()=>{this.resource=null},e=>this.onError(e)).catch(e=>this.onError(e))}static \u0275fac=function(r){return new(r||t)(b(V),b(C),b(X,8))};static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})(),ee=(()=>{class t{service;route;auth;router;perms={delete:!1,edit:!1};routerSubscription;constructor(e,r,i,n){this.service=e,this.route=r,this.auth=i,this.router=n}ngOnInit(){this.init(),this.routerSubscription=this.router.events.subscribe(e=>{e instanceof Z&&this.init()})}ngOnDestroy(){this.routerSubscription.unsubscribe()}init(){return this.service.init(this.route).then(()=>this.auth.ready.then(()=>this.service.formFormio.userPermissions(this.auth.user,this.service.form,this.service.resource).then(e=>(this.perms.delete=e.delete,this.perms.edit=e.edit,this.service.resource))))}static \u0275fac=function(r){return new(r||t)(o(R),o(g),o(k),o(y))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:10,vars:2,consts:[[1,"nav","nav-tabs",2,"margin-bottom","10px"],[1,"nav-item"],["routerLink","../",1,"nav-link"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"],["routerLinkActive","active",1,"nav-item"],["routerLink","view","routerLinkActive","active",1,"nav-link"],["class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","edit","routerLinkActive","active",1,"nav-link"],["routerLink","delete","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-trash","bi","bi-trash"]],template:function(r,i){r&1&&(c(0,"ul",0)(1,"li",1)(2,"a",2),l(3,"em",3),s()(),c(4,"li",4)(5,"a",5),f(6,"View"),s()(),j(7,J,3,0,"li",6)(8,K,3,0,"li",6),s(),l(9,"router-outlet")),r&2&&(p(7),u("ngIf",i.perms.edit),p(),u("ngIf",i.perms.delete))},dependencies:[E,z,L,Q],encapsulation:2})}return t})(),te=(()=>{class t{service;config;constructor(e,r){this.service=e,this.config=r}submission={data:{}};ngOnDestroy(){m.Formio.clearCache()}static \u0275fac=function(r){return new(r||t)(o(R),o(C))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:1,vars:4,consts:[[3,"form","submission","hideComponents","readOnly"]],template:function(r,i){r&1&&l(0,"formio",0),r&2&&u("form",i.service.form)("submission",i.service.resource)("hideComponents",i.config.parents)("readOnly",!0)},dependencies:[I],encapsulation:2})}return t})(),re=(()=>{class t{service;route;router;config;triggerError=new d;onSubmitDone=new d;submission={data:{}};constructor(e,r,i,n){this.service=e,this.route=r,this.router=i,this.config=n}onSubmit(e){let r=this.service.resource;r.data=e.data,this.service.save(r).then(()=>{this.onSubmitDone.emit(this.service.resource),this.router.navigate(["../","view"],{relativeTo:this.route})}).catch(i=>this.triggerError.emit(i))}ngOnDestroy(){m.Formio.clearCache()}static \u0275fac=function(r){return new(r||t)(o(R),o(g),o(y),o(C))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:1,vars:4,consts:[[3,"submit","form","submission","error","submitDone"]],template:function(r,i){r&1&&(c(0,"formio",0),v("submit",function(a){return i.onSubmit(a)}),s()),r&2&&u("form",i.service.form)("submission",i.service.resource)("error",i.triggerError)("submitDone",i.onSubmitDone)},dependencies:[I],encapsulation:2})}return t})(),ie=(()=>{class t{service;route;router;constructor(e,r,i){this.service=e,this.route=r,this.router=i}onDelete(){this.service.remove().then(()=>{this.router.navigate(["../../"],{relativeTo:this.route})})}onCancel(){this.router.navigate(["../","view"],{relativeTo:this.route})}static \u0275fac=function(r){return new(r||t)(o(R),o(g),o(y))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:7,vars:0,consts:[[1,"btn-toolbar"],["type","button",1,"btn","btn-danger",2,"margin-right","10px",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(r,i){r&1&&(c(0,"h3"),f(1,"Are you sure you wish to delete this record?"),s(),c(2,"div",0)(3,"button",1),v("click",function(){return i.onDelete()}),f(4,"Yes"),s(),c(5,"button",2),v("click",function(){return i.onCancel()}),f(6,"No"),s()())},encapsulation:2})}return t})(),oe=(()=>{class t{service;route;router;config;onError;onSuccess;constructor(e,r,i,n){this.service=e,this.route=r,this.router=i,this.config=n,this.onError=new d,this.onSuccess=new d}ngOnInit(){this.service.init(this.route)}onSubmit(e){this.service.save(e).then(()=>{this.router.navigate(["../",this.service.resource._id,"view"],{relativeTo:this.route})}).catch(r=>this.onError.emit(r))}static \u0275fac=function(r){return new(r||t)(o(R),o(g),o(y),o(C))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:2,vars:6,consts:[["style","margin-top:0;",4,"ngIf"],[3,"submit","form","submission","refresh","error","success"],[2,"margin-top","0"],["routerLink","../",1,"back-button"],[1,"fa","fa-chevron-left","bi","bi-chevron-left"]],template:function(r,i){r&1&&(j(0,W,4,1,"h3",0),c(1,"formio",1),v("submit",function(a){return i.onSubmit(a)}),s()),r&2&&(u("ngIf",i.service.form),p(),u("form",i.service.form)("submission",i.service.resource)("refresh",i.service.refresh)("error",i.onError)("success",i.onSuccess))},dependencies:[E,I,L],styles:[".back-button[_ngcontent-%COMP%]{font-size:.8em}"]})}return t})(),ne=(()=>{class t{service;route;router;config;cdr;ngZone;gridSrc;gridQuery;createText;constructor(e,r,i,n,a,S){this.service=e,this.route=r,this.router=i,this.config=n,this.cdr=a,this.ngZone=S}ngOnInit(){this.service.init(this.route).then(()=>{this.gridQuery={},this.service&&this.config.parents&&this.config.parents.length?this.service.loadParents().then(e=>{(0,w.each)(e,r=>{r&&r.filter&&(this.gridQuery["data."+r.name+"._id"]=r.resource._id)}),this.gridSrc=this.service.formUrl,this.createText=`New ${this.service.form.title}`,this.cdr.detectChanges()}):this.service.formUrl&&(this.gridSrc=this.service.formUrl,this.createText=`New ${this.service.form.title}`)})}onSelect(e){this.ngZone.run(()=>{this.router.navigate([e._id,"view"],{relativeTo:this.route})})}onCreateItem(){this.ngZone.run(()=>{this.router.navigate(["new"],{relativeTo:this.route})})}static \u0275fac=function(r){return new(r||t)(o(R),o(g),o(y),o(C),o($),o(P))};static \u0275cmp=h({type:t,selectors:[["ng-component"]],decls:2,vars:5,consts:[[3,"alerts"],[3,"rowSelect","error","createItem","src","query","onForm","createText"]],template:function(r,i){r&1&&(l(0,"formio-alerts",0),c(1,"formio-grid",1),v("rowSelect",function(a){return i.onSelect(a)})("error",function(a){return i.service.onError(a)})("createItem",function(){return i.onCreateItem()}),s()),r&2&&(u("alerts",i.service.alerts),p(),u("src",i.gridSrc)("query",i.gridQuery)("onForm",i.service.formLoaded)("createText",i.createText))},dependencies:[q,G],encapsulation:2})}return t})();function we(t){return[{path:"",component:t&&t.index?t.index:ne},{path:"new",component:t&&t.create?t.create:oe},{path:":id",component:t&&t.resource?t.resource:ee,children:[{path:"",redirectTo:"view",pathMatch:"full"},{path:"view",component:t&&t.view?t.view:te},{path:"edit",component:t&&t.edit?t.edit:re},{path:"delete",component:t&&t.delete?t.delete:ie}]}]}export{C as a,X as b,R as c,we as d};
