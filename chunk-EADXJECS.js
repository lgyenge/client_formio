import{A as g,Ab as R,B as U,D as v,Eb as f,F as p,G as k,Gb as j,P as l,V as u,Xa as b,da as h,e as F,eb as w,ga as a,gb as S,ha as c,hb as L,ia as A,ib as E,jb as O,la as d,va as y,wb as D,xb as M}from"./chunk-BSRB5NMX.js";var s=F(O(),1),i=F(D(),1);var P=(()=>{class e{component;delayAuth;login;register;resetpass;oauth;static \u0275fac=function(t){return new(t||e)};static \u0275prov=g({token:e,factory:e.\u0275fac})}return e})();var C=(()=>{class e{appConfig;config;user;authenticated=!1;loginForm;onLogin;onLogout;registerForm;onRegister;onUser;onError;resetPassForm;onResetPass;ready;readyResolve;readyReject;projectReady;accessReady;userReady;formAccess={};submissionAccess={};roles;is={};constructor(o,t){this.appConfig=o,this.config=t,this.user=null,this.appConfig&&this.appConfig.appUrl?(i.Formio.setBaseUrl(this.appConfig.apiUrl),i.Formio.setProjectUrl(this.appConfig.appUrl),i.Formio.formOnly=!!this.appConfig.formOnly):console.error("You must provide an AppConfig within your application!"),this.loginForm=this.appConfig.appUrl+"/"+(0,s.get)(this.config,"login.form","user/login"),this.registerForm=this.appConfig.appUrl+"/"+(0,s.get)(this.config,"register.form","user/register"),this.resetPassForm=this.appConfig.appUrl+"/"+(0,s.get)(this.config,"register.form","resetpass"),this.onLogin=new l,this.onLogout=new l,this.onRegister=new l,this.onUser=new l,this.onError=new l,this.ready=new Promise((n,r)=>{this.readyResolve=n,this.readyReject=r}),i.Formio.events.on("formio.badToken",()=>this.logoutError()),i.Formio.events.on("formio.sessionExpired",()=>this.logoutError()),this.config.delayAuth||this.init()}onLoginSubmit(o){this.setUser(o),this.onLogin.emit(o)}onRegisterSubmit(o){this.setUser(o),this.onRegister.emit(o)}onResetPassSubmit(o){this.onResetPass.emit(o)}init(){this.projectReady=i.Formio.makeStaticRequest(this.appConfig.appUrl).then(t=>{(0,s.each)(t.access,n=>{this.formAccess[n.type]=n.roles})},()=>(this.formAccess={},null)),this.accessReady=i.Formio.makeStaticRequest(this.appConfig.appUrl+"/access").then(t=>((0,s.each)(t.forms,n=>{this.submissionAccess[n.name]={},n.submissionAccess.forEach(r=>{this.submissionAccess[n.name][r.type]=r.roles})}),this.roles=t.roles,t)).catch(t=>((t==="Token Expired"||t==="Bad Token")&&this.setUser(null),this.roles={},null));let o;this.config.oauth?(window.location.hash&&window.location.hash.match(/^#\/access_token/)&&history.pushState(null,null,window.location.hash.replace(/^#\/access_token/,"#access_token")),o=i.Formio.ssoInit(this.config.oauth.type,this.config.oauth.options)):o=i.Formio.currentUser(null,{ignoreCache:!0}),this.userReady=o.then(t=>(this.setUser(t),t)).catch(t=>{throw this.setUser(null),t}),this.accessReady&&this.accessReady.then(()=>this.projectReady).then(()=>this.userReady).then(()=>this.readyResolve(!0)).catch(t=>this.readyReject(t))}setUser(o){let t=i.Formio.namespace||"formio";o?(this.user=o,localStorage.setItem(`${t}AppUser`,JSON.stringify(o)),this.setUserRoles(),i.Formio.setUser(o)):(this.user=null,this.is={},localStorage.removeItem(`${t}AppUser`),i.Formio.clearCache(),i.Formio.setUser(null)),this.authenticated=!!i.Formio.getToken(),this.onUser.emit(this.user)}setUserRoles(){this.accessReady&&this.accessReady.then(()=>{(0,s.each)(this.roles,(o,t)=>{this.user.roles.indexOf(o._id)!==-1&&(this.is[t]=!0)})})}logoutError(){this.setUser(null);let o=i.Formio.namespace||"formio";localStorage.removeItem(`${o}Token`),this.onError.emit()}logout(){let o=i.Formio.namespace||"formio",t=`${o}Token`;localStorage.removeItem(t),i.Formio.tokens&&i.Formio.tokens.hasOwnProperty(t)&&delete i.Formio.tokens[t],i.Formio.logout().then(()=>{this.setUser(null),localStorage.getItem(`${o}LogoutAuthUrl`)&&(window.open(localStorage.getItem(`${o}LogoutAuthUrl`),null,"width=1020,height=618"),localStorage.removeItem(`${o}LogoutAuthUrl`)),this.onLogout.emit()}).catch(()=>this.logoutError())}static \u0275fac=function(t){return new(t||e)(v(M),v(P))};static \u0275prov=g({token:e,factory:e.\u0275fac})}return e})(),T=(()=>{class e{static \u0275fac=function(t){return new(t||e)};static \u0275cmp=p({type:e,selectors:[["ng-component"]],decls:11,vars:0,consts:[[1,"card","card-primary","panel","panel-default"],[1,"card-header","panel-heading"],[1,"nav","nav-tabs","card-header-tabs"],["role","presentation","routerLinkActive","active",1,"nav-item"],["routerLink","login","routerLinkActive","active",1,"nav-link"],["routerLink","register","routerLinkActive","active",1,"nav-link"],[1,"card-body","panel-body"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"ul",2)(3,"li",3)(4,"a",4),y(5,"Login"),c()(),a(6,"li",3)(7,"a",5),y(8,"Register"),c()()()(),a(9,"div",6),A(10,"router-outlet"),c()())},dependencies:[w,S,L],encapsulation:2})}return e})(),_=(()=>{class e{service;renderOptions={submitOnEnter:!0};constructor(o){this.service=o}static \u0275fac=function(t){return new(t||e)(u(C))};static \u0275cmp=p({type:e,selectors:[["ng-component"]],decls:1,vars:2,consts:[[3,"submit","src","renderOptions"]],template:function(t,n){t&1&&(a(0,"formio",0),d("submit",function(m){return n.service.onLoginSubmit(m)}),c()),t&2&&h("src",n.service.loginForm)("renderOptions",n.renderOptions)},dependencies:[f],encapsulation:2})}return e})(),$=(()=>{class e{service;renderOptions={submitOnEnter:!0};constructor(o){this.service=o}static \u0275fac=function(t){return new(t||e)(u(C))};static \u0275cmp=p({type:e,selectors:[["ng-component"]],decls:1,vars:2,consts:[[3,"submit","src","renderOptions"]],template:function(t,n){t&1&&(a(0,"formio",0),d("submit",function(m){return n.service.onRegisterSubmit(m)}),c()),t&2&&h("src",n.service.registerForm)("renderOptions",n.renderOptions)},dependencies:[f],encapsulation:2})}return e})(),N=(()=>{class e{service;constructor(o){this.service=o}static \u0275fac=function(t){return new(t||e)(u(C))};static \u0275cmp=p({type:e,selectors:[["ng-component"]],decls:1,vars:1,consts:[[3,"submit","src"]],template:function(t,n){t&1&&(a(0,"formio",0),d("submit",function(m){return n.service.onResetPassSubmit(m)}),c()),t&2&&h("src",n.service.resetPassForm)},dependencies:[f],encapsulation:2})}return e})();function I(e){return[{path:"",component:e&&e.auth?e.auth:T,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:e&&e.login?e.login:_},{path:"register",component:e&&e.register?e.register:$},{path:"resetpass",component:e&&e.resetpass?e.resetpass:N}]}]}var V=(()=>{class e{static forRoot(o){return R(e,o,I)}static forChild(o){return R(e,o,I)}static \u0275fac=function(t){return new(t||e)};static \u0275mod=k({type:e});static \u0275inj=U({imports:[b,j,E]})}return e})();export{P as a,C as b,_ as c,I as d,V as e};
